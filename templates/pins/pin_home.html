{% extends 'pins/album_base.html' %}
{% load comments %}

{% block content %}
{{block.super}}
<div class="row-fluid">
    <div class="span9">
        <div class="row-fluid">
            <img src="{{ pin.file.url }}" alt="{{ pin.file.name }}">
        </div>
        <div class="row-fluid">
            {% csrf_token %}
            {% get_comment_form for pin as form %}
            <table class="table">
                <form class="form form-horizontal well" action="{% comment_form_target %}" method="post">
                    {% csrf_token %}
                    <tbody>
                            <tr>
                            <th><label for="id_comment">评论:</label></th>
                            <td><textarea id="id_comment" rows="10" cols="100" name="comment"></textarea></td>
                        </tr>
                        <tr>
                            <th><label for="id_honeypot">垃圾防范:</label></th>
                            <td>
                                <input type="text" name="honeypot" id="id_honeypot"><input type="hidden" name="content_type" value="pins.pin" id="id_content_type">
                                <input type="hidden" name="object_pk" value="60" id="id_object_pk">
                                <input type="hidden" name="timestamp" value="1343482826" id="id_timestamp">
                                <input type="hidden" name="security_hash" value="5454795582274d8bcdc6806e5de2d11522d96c4e" id="id_security_hash">
                                <label for="id_honeypot">如果你在该字段中输入任何内容，那么你的评论就会被视为垃圾评论。
                            </td>
                        </tr>
                        <tr>
                            <th></th>
                            <td colspan="2">
                                <input class="btn-primary btn-large" type="submit" name="submit" value="提交">
                                <input type="hidden" name="next" value="{% url pin:home pin.pk %}">
                            </td>
                        </tr>
                    </tbody>
                </form>
            </table>

            {% get_comment_count for pin as comment_count %}
            <h3>{{ comment_count }} 条评论:</h3>
            {% get_comment_list for pin as comment_list %}
            <ol>
            {% for c in comment_list %}
                <li class="">
                <span>{{c.user}} 发表于 {{c.submit_date}}</span>
                <pre>{{c.comment}}</pre>
                </li>
            {% endfor %}
            </ol>
        </div>
    </div>

    <div class="span3">
        <div class="row-fluid">
            <h2>{{pin.album.name}}</h2>
            <p><i>{{pin.album.user}}</i>, <small>{{pin.album.create}}</small></p>
        </div>
        <div class="row-fluid">
            <div class="btn-toolbar">
                <div class="btn-group">
                    <a class="btn btn-info btn-large" href="{% url pin:nav pin.pk %}?direct=prev">
                        <i class="icon-chevron-left icon-white"></i>
                        上一张
                    </a>
                    <a class="btn btn-info btn-large" href="{% url pin:nav pin.pk %}?direct=next">
                        下一张
                        <i class="icon-chevron-right icon-white"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="row-fluid">
            <div class="btn-toolbar">
                <div class="btn-group">
                    <a class="btn btn-warning" href="{% url pin:rotate pin.id %}?angle=90">
                        <i class="icon-chevron-left icon-white"></i>
                        左旋
                    </a>
                    <a class="btn btn-warning" href="{% url pin:rotate pin.id %}?angle=270">
                        右旋
                        <i class="icon-chevron-right icon-white"></i>
                    </a>
                </div>
            </div>
        </div>
        {% if user.is_authenticated and user.username == album.user.username %}
        <div class="row-fluid">
            <div class="btn-toolbar">
                <div class="btn-group">
                    <a class="btn btn-danger btn-small" data-toggle="modal" href="#modal-delete-pin" ><i class="icon-trash icon-white"></i>删除</a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

</div>

<div class="modal hide" id="modal-delete-pin">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>删除照片</h3>
    </div>
    <div class="modal-body">
        <p>照片删除后不能恢复,确认继续?</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn close" data-dismiss="modal">取消</a>
        <a href="{% url pin:delete pin.id %}" class="btn btn-danger">确认删除</a>
    </div>
</div>

{% endblock %}

